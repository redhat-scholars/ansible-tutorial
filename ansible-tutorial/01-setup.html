<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup :: Ansible Tutorial</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/ansible-tutorial/ansible-tutorial/01-setup.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="02-getting-started.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/ansible-tutorial">Ansible Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ansible-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ansible">Setup Ansible</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#downloadtutorial">Get Tutorial Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#preparingkeys">Preparing SSH keys</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#bootingservers">Booting Servers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-getting-started.html">2. Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-getting-started.html#ide">Editor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-getting-started.html#inventory">Defining an Inventory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-getting-started.html#runningansible">Running Ansible</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-getting-started.html#escalation">Privilege Escalation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-getting-started.html#playbook">Playbooks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-advanced.html">3. Templates</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-advanced.html#createtemplates">Create Templates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-advanced.html#ansiblevault">Securing Files</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-roles.html">4. Roles</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-roles.html#firstrole">First Role</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-roles.html#handlers">Handlers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-roles.html#sharingroles">Sharing Roles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-roles.html#ansiblegalaxy">Ansible Galaxy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Ansible Tutorial</a></li>
    <li><a href="01-setup.html">1. Setup</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/ansible-tutorial/edit/master/documentation/modules/ROOT/pages/01-setup.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Setup</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you&#8217;ll learn:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-check-square-o"></i> Installing the tools required for running this deep dive</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisite"><a class="anchor" href="#prerequisite"></a>Prerequisite CLI tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following CLI tools are required for running the exercises in this tutorial.
Please have them installed and configured before you get started with any of the tutorial chapters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Tool</strong></th>
<th class="tableblock halign-center valign-top"><strong>macOS</strong></th>
<th class="tableblock halign-center valign-top"><strong>Linux</strong></th>
<th class="tableblock halign-center valign-top"><strong>windows</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Git</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://git-scm.com/download/mac" target="_blank" rel="noopener">Download</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://git-scm.com/download/linux" target="_blank" rel="noopener">Download</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://git-scm.com/download/win" target="_blank" rel="noopener">Download</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Docker</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://docs.docker.com/docker-for-mac/install" target="_blank" rel="noopener">Docker for Mac</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dnf/apt-get/&#8230;&#8203; install docker</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://docs.docker.com/docker-for-windows/install" target="_blank" rel="noopener">Docker for Windows</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Python</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://www.python.org/ftp/python/3.11.1/python-3.11.1-macos11.pkg" class="bare">https://www.python.org/ftp/python/3.11.1/python-3.11.1-macos11.pkg</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dnf/apt-get/&#8230;&#8203; install python3</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://www.python.org/downloads/windows/" class="bare">https://www.python.org/downloads/windows/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Pip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>python -m ensurepip --upgrade</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>python -m ensurepip --upgrade</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>py -m ensurepip --upgrade</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In case of not having <code>ensurepip</code> module installed, you can always download <code>get-pip.py</code> file and execute it. You can find more information in <a href="https://pip.pypa.io/en/stable/installation/" class="bare">https://pip.pypa.io/en/stable/installation/</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ansible"><a class="anchor" href="#ansible"></a>Setup Ansible</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install Ansible and all its toolset, use <code>pip</code>.
In a terminal window, run the following command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo pip install ansible --upgrade</code></pre>
</div>
</div>
<div class="paragraph">
<p>And check that ansible is installed:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ansible --version</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-terminal hljs" data-lang="terminal">ansible [core 2.14.1]
  config file = None
  configured module search path = ['/Users/asotobu/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/local/lib/python3.10/site-packages/ansible
  ansible collection location = /Users/asotobu/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/local/bin/ansible
  python version = 3.10.9 (main, Dec 15 2022, 18:18:30) [Clang 14.0.0 (clang-1400.0.29.202)] (/usr/local/opt/python@3.10/bin/python3.10)
  jinja version = 3.1.2
  libyaml = True</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="downloadtutorial"><a class="anchor" href="#downloadtutorial"></a>Get tutorial sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we start setting up the environment, let’s clone the tutorial sources and set the <code>TUTORIAL_HOME</code> environment variable to point to the root directory of the tutorial:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone <a href="https://github.com/redhat-scholars/ansible-tutorial" class="bare">https://github.com/redhat-scholars/ansible-tutorial</a> ansible-tutorial</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export TUTORIAL_HOME="$(pwd)/ansible-tutorial"</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparingkeys"><a class="anchor" href="#preparingkeys"></a>Preparing Keys</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible uses SSH to run commands against managed machines.
To login to these machines, you can use login/password, but the most common way is using public/private keys to login.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In case of using Microsoft Windows, you might need to install <a href="https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse?tabs=gui" target="_blank" rel="noopener">OpenSSH client for Windows</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s create a pair of keys.
Run the following command in a terminal window:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh-keygen -f ~/.ssh/id_rsa_ansible</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-terminal hljs" data-lang="terminal">Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Passphrases do not match.  Try again.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /Users/asotobu/.ssh/id_rsa_ansible
Your public key has been saved in /Users/asotobu/.ssh/id_rsa_ansible.pub</code></pre>
</div>
</div>
<div class="paragraph">
<p>Validate the creation of the keys.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat ~/.ssh/id_rsa_ansible.pub</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-terminal hljs" data-lang="terminal">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDISVzwTEBoVEygssPwpI/SmZkBvSgWcwkPfCWBTFpXRBJuxA3q+4dBf4lWKt2g1sXoF55KEWsBVcFPKHKb6jkg10gStIvjhEb9eglRSNUPR0yZxjvSNskrimlndSkx59GpL8F1JMo4oXSKtzV3zif/Rapp2SUG8P+iATqxU9FRNnauqiR843OP6rEpNnPKk1TRUV8cHjtCLb0ZXIlMdYDBuosLoykjMr8dW4CKwCZ8SYSPOeuvFDBOSRpdyr1/h97xSxUVVlu2CiEij1wCKjg1MbGPyDprVyYC7rWriMn31iyoLymX9gE5V4hdF3KgHaAh/88dEXRJxX7m57QccT2xP86HriAswNjssuJ1kpaDLesliQeThQ5eVHow2+FHUZsquvGyr8rSsyfeNyGgOGFzI4gOs1DzJ9OEBbHI+RsLoDe4/E+pVD4SlWGW5WZRCIRMEBkFLI9am0m0PBWXupdsWhTxQyrUHPyrVF490uJZcsJyFvDjlY+6cb0GdODWuhE= <a href="mailto:asotobu@Alexs-MacBook-Pro-3.local">asotobu@Alexs-MacBook-Pro-3.local</a></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootingservers"><a class="anchor" href="#bootingservers"></a>Booting Servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible manages servers, and we need some servers to work.
One option could be to prepare some virtual machines and start them locally, but since these are heavy, we are providing a <code>docker-compose</code> file that starts two containers acting as "virtual machines".</p>
</div>
<div class="paragraph">
<p>In a terminal window, go to the <code>apps</code> directory and run the <code>docker-compose</code> command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker-compose up --remove-orphans</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Attaching to apps_preprod_1, apps_prod_1
prod_1     | /usr/lib/python3.11/site-packages/supervisor/options.py:474: UserWarning: Supervisord is running as root and it is searching for its configuration file in default locations (including its current working directory); you probably want to specify a "-c" argument specifying an absolute path to a configuration file for improved security.
prod_1     |   self.warnings.warn(
preprod_1  | /usr/lib/python3.11/site-packages/supervisor/options.py:474: UserWarning: Supervisord is running as root and it is searching for its configuration file in default locations (including its current working directory); you probably want to specify a "-c" argument specifying an absolute path to a configuration file for improved security.
preprod_1  |   self.warnings.warn(
prod_1     | 2023-02-07 08:57:47,469 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.
prod_1     | 2023-02-07 08:57:47,470 WARN No file matches via include "/etc/supervisord.d/*.conf"
preprod_1  | 2023-02-07 08:57:47,469 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.
preprod_1  | 2023-02-07 08:57:47,471 WARN No file matches via include "/etc/supervisord.d/*.conf"
preprod_1  | 2023-02-07 08:57:47,487 INFO RPC interface 'supervisor' initialized
preprod_1  | 2023-02-07 08:57:47,487 CRIT Server 'unix_http_server' running without any HTTP authentication checking
preprod_1  | 2023-02-07 08:57:47,488 INFO supervisord started with pid 1
prod_1     | 2023-02-07 08:57:47,489 INFO RPC interface 'supervisor' initialized
prod_1     | 2023-02-07 08:57:47,490 CRIT Server 'unix_http_server' running without any HTTP authentication checking
prod_1     | 2023-02-07 08:57:47,490 INFO supervisord started with pid 1
preprod_1  | 2023-02-07 08:57:48,493 INFO spawned: 'sshd' with pid 7
prod_1     | 2023-02-07 08:57:48,495 INFO spawned: 'sshd' with pid 8
prod_1     | 2023-02-07 08:57:49,499 INFO success: sshd entered RUNNING state, process has stayed up for &gt; than 1 seconds (startsecs)
preprod_1  | 2023-02-07 08:57:49,499 INFO success: sshd entered RUNNING state, process has stayed up for &gt; than 1 seconds (startsecs)</code></pre>
</div>
</div>
<div class="paragraph">
<p>See that each server exposes SSH service in different ports, one to <code>2223</code> and the other to <code>2224</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ansibleservers.png" alt="ansibleservers">
</div>
</div>
<div class="paragraph">
<p>The last step before we can start using Ansible is copying the public key into the servers, so we can login using the local private key generated in the previous step.</p>
</div>
<div class="paragraph">
<p>In another terminal window run the following commands to copy the public key generated before.
The password to encrypt is <code>mypassword</code>:</p>
</div>
<div class="listingblock console-input">
<div class="title">Server One</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh-copy-id -i ~/.ssh/id_rsa_ansible -p 2223 root@localhost</code></pre>
</div>
</div>
<div class="listingblock console-oupt">
<div class="title">Server One</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-terminal hljs" data-lang="terminal">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed:
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 keys remain to be installed if you are prompted now it is to install the new keys
root@localhost s password:

Number of key(s) added:        1

Now try logging into the machine, with:   "ssh -p '2223' 'root@localhost'"
and check to make sure that only the key(s) you wanted were added.</code></pre>
</div>
</div>
<div class="paragraph">
<p>And do the same  with the other service which is in port <code>2224</code>.</p>
</div>
<div class="listingblock console-input">
<div class="title">Server One</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh-copy-id -i ~/.ssh/id_rsa_ansible -p 2224 root@localhost</code></pre>
</div>
</div>
<div class="listingblock console-oupt">
<div class="title">Server One</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-terminal hljs" data-lang="terminal">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed:
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@localhost s password:

Number of key(s) added:        1

Now try logging into the machine, with:   "ssh -p '2224' 'root@localhost'"
and check to make sure that only the key(s) you wanted were added.</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Ansible Tutorial</a></span>
  <span class="next"><a href="02-getting-started.html">2. Getting Started</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
